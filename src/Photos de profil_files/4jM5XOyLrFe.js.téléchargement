if (self.CavalryLogger) { CavalryLogger.start_js(["BaKGw"]); }

__d("XPrivacyCustomSaveController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/privacy/custom/save/",{id:{type:"String"},allow:{type:"String"},deny:{type:"String"},settings:{type:"String"},dont_update_sticky:{type:"Bool",defaultValue:!1},return_uri:{type:"String"}})}),null);
__d("MSavedCustomAudienceSelector",["csx","CSS","DOM","EventListener","LoadingIndicator","MCompositionPrivacyStore","MModalDialog","MRequest","Parent","PrivacyConst","Stratcom","XPrivacyCustomSaveController","goURI"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c,d,e,f,g,h,i,j,k,l){var m=this;this.setLoading=function(a){this.$2=a};this.$16=function(a){a=a.getNode("typeahead-result");if(a==null)return;var b=a.getAttribute("rel");a=a.firstElementChild;if(b==null||a==null)return;m.$21(a,b,!m.$8.has(b))};this.$13=function(a){var c=b("Parent").bySelector(a.target,"._5f25"),d=a.target.value;a=a.target.checked;this.$21(c,d,a)};this.$21=function(a,c,d){if(!this.$7.has(c)){a=a.cloneNode(!0);b("CSS").removeClass(a,"touched");b("DOM").appendContent(this.$4,a);this.$7.add(c)}d?this.$8.add(c):this.$8["delete"](c);a=b("DOM").scry(this.$3,"input");a.forEach(function(a){a.value===c&&(a.checked=d)})};this.$14=function(a){a=a.target.value.trim()==="";this.$22(a,!1)};this.$15=function(a){this.$5.value="",this.$22(!0,!1)};this.$20=function(a){a=a.getData();a=a.resultCount;var b=m.$5.value.trim()==="";m.$22(b,a<=0)};this.$22=function(a,c){b("CSS").conditionShow(this.$3,a),b("CSS").conditionShow(this.$6,!a),b("CSS").conditionShow(this.$12,!a&&c),a&&b("Stratcom").invoke("search-cancel")};this.getData=function(){var a=this.$23(),c=[],d=[];this.$9==="friends_except"?(c=[b("PrivacyConst").CustomPrivacyTokens.FRIENDS],d=Array.from(this.$8)):c=Array.from(this.$8);return{id:this.$11,allow:c,deny:d,dontUpdateSticky:a}};this.$19=function(){var a=this,c=b("XPrivacyCustomSaveController").getURIBuilder().getURI();c=new(b("MRequest"))(c).setAutoProcess(!1).setMethod("POST").setData(this.getData());c.listen("done",function(c){b("Stratcom").invoke("MCustomPrivacy::save",null,c),a.$1()});this.$2();c.send()};this.$18=function(){b("LoadingIndicator").show(),b("MModalDialog").close({canceled:!1,goBack:!0})};this.$17=function(){b("goURI")(this.$10)};this.setNavigation=function(a){this.$1=a};this.$23=function(){return this.$11==="0"?b("MCompositionPrivacyStore").get("NEVER_SAVE_STICKY",!1):!0};this.isSelected=function(a){return this.$8.has(a)};this.$4=c;this.$3=a;this.$7=g;this.$8=h;this.$5=e;this.$6=f;this.$9=i;this.$10=j;this.$11=k;this.$12=l;var n=[];n.push(b("EventListener").listen(a,"change",this.$13.bind(this)));n.push(b("EventListener").listen(d,"input",this.$14.bind(this)));n.push(b("EventListener").listen(f,"click",this.$15.bind(this)));n.push((c=b("Stratcom")).listen(["touchstart","mousedown"],"jx-typeahead-results",this.$16));n.push(c.listen("click","jx-typeahead-results",function(a){a.setCanPreventDefaultInRawEvent(!0).prevent()}));this.$1=function(){return m.$17()};this.$2=function(){return m.$18()};n.push(c.listen("click","saved-custom-privacy-save",this.$19.bind(this)));n.push(c.listen("saved-custom-search-show-results","*",this.$20));n.push(c.listen([b("MModalDialog").WILL_CLOSE_EVENT,b("MModalDialog").STEP_CHANGE_EVENT,"m:page:unload"],null,function(){n&&n.forEach(function(a){a.remove()}),n=null}))};e.exports=a}),null);
__d("MSavedCustomAudienceSelectorStore",["CSS","DOM","MSavedCustomAudienceSelector"],(function(a,b,c,d,e,f){"use strict";a={_instances:{},_onNavigation:null,_onLoading:null,init:function(a,c,d,e,f,g,h,i,j,k,l){a=new(b("MSavedCustomAudienceSelector"))(a,c,d,e,f,g,h,i,j,k,l);this._onNavigation!==null&&a.setNavigation(this._onNavigation);this._onLoading!==null&&a.setLoading(this._onLoading);this._instances[i]=a},getInstance:function(a){return this._instances[a]},setNavigation:function(a){this._onNavigation=a},setLoading:function(a){this._onLoading=a},resetNavigationAndLoading:function(){this._onNavigation=null,this._onLoading=null},syncPagedItems:function(a,c){var d=this,e=b("DOM").scry(a,"input");e.forEach(function(a){d.getInstance(c).isSelected(a.value)&&(a.checked=!0)});b("CSS").show(a)}};e.exports=a}),null);
__d("XPrivacyTimelineSavedCustomAudienceSelectorDialogController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/privacy/timeline/saved_custom_audience_selector_dialog/",{selected_option:{type:"String"},has_tags:{type:"Bool",defaultValue:!1},use_small_icon:{type:"Bool",defaultValue:!1}})}),null);
__d("MBlackbirdTimelinePrivacySelectorListener",["csx","CSS","DOM","MCompositionPrivacyStore","MModalDialog","MRequest","MSavedCustomAudienceSelectorStore","Parent","Stratcom","XPrivacyCustomEditController","XPrivacyTimelineSavedCustomAudienceSelectorDialogController","$","ge"],(function(a,b,c,d,e,f,g){"use strict";a={_privacyField:null,_activeCustomDialogID:null,_savedCustomType:null,_updateIcon:function(){},_customListener:null,_useSmallIcon:!1,initPrivacyButton:function(a,c,d,e){var f=this;this._privacyField=c;this._useSmallIcon=e;b("DOM").listen(a,"click",null,function(){f.openSelector(a,d)})},openSelector:function(a,c){var d=this;c||b("DOM").hide(this._getComposerView());this._customListener===null&&this._setupCustomListener();b("MSavedCustomAudienceSelectorStore").setNavigation(function(){b("MModalDialog").close({canceled:!1,goBack:!0})});b("MSavedCustomAudienceSelectorStore").setLoading(function(){b("MModalDialog").setSpinnerVisibility(!0),b("MModalDialog").setHeaderButtonsEnabledState(!1)});var e=b("DOM").scry(b("$")("m_composer_privacy_selector"),"input")[0].value;b("MModalDialog").open(b("XPrivacyTimelineSavedCustomAudienceSelectorDialogController").getURIBuilder().setString("selected_option",e).setBool("has_tags",this._hasTags(a)).setBool("use_small_icon",this._useSmallIcon).getURI(),function(){c||(b("DOM").hide(b("$")("viewport")),b("DOM").show(d._getComposerView()));if(d._hasTags(a)){var e=b("DOM").find(a,"span","plus-label");b("DOM").show(e)}})},initCustomMenuListener:function(a,c,d){var e=this;b("DOM").listen(a,"click",null,function(){e._updateIcon=function(){var c=b("ge")("m_composer_privacy_selector");if(c){c=b("DOM").find(c,"div","privacy-button-icon");var d=b("DOM").scry(a,"i","small-icon")[0]||b("DOM").scry(a,"i","icon")[0];d!=null&&b("DOM").setContent(c,e._newIconFromElement(d))}}})},initSelectionListener:function(a){var c=this,d=b("Stratcom").listen("MPrivacySettingsSelector:selected",null,function(d){d=d.getData();if(d.isCustom){var e=b("XPrivacyCustomEditController").getURIBuilder().setString("privacy_id",d.value).getURI();b("MModalDialog").load(e.toString());b("MModalDialog").setHeaderButtonsEnabledState(!0)}else d.isSavedCustom||(c._updateIconForData(d),c._updateLabel(d.labelElement.innerText),c._updateSticky(a,d.value),b("Stratcom").invoke("MPrivacyComposerMenu::change",null,{value:d.value,showPlus:!0,iconHTML:d.iconElement,optionLabel:d.labelElement,instance:c}))});b("Stratcom").listen(["m:history:change","MCustomPrivacy::removeListener"],null,function(){d.remove(),b("Stratcom").removeCurrentListener()})},_setupCustomListener:function(){var a=this;this._customListener=b("Stratcom").listen("MCustomPrivacy::save",null,function(c){c=c.getData();a._updateIcon();a._updateLabel(c.payload.description);a._privacyField.value=c.payload.value;b("Stratcom").invoke("MPrivacyComposerMenu::change",null,{value:c.payload.value})});b("Stratcom").listen(["MCustomPrivacy::removeListener","m:page:unload"],null,function(){a._customListener&&a._customListener.remove(),a._customListener=null,b("Stratcom").removeCurrentListener(),b("MSavedCustomAudienceSelectorStore").resetNavigationAndLoading()})},_newIconFromElement:function(a){a=a.cloneNode(!0);return b("CSS").show(a)},_updateIconForData:function(a){this._privacyField.value=a.value;var c=b("ge")("m_composer_privacy_selector");if(c){c=b("DOM").find(c,"div","privacy-button-icon");b("DOM").setContent(c,this._newIconFromElement(a.smallIconElement||a.iconElement))}},_updateLabel:function(a){var c=b("ge")("m_composer_privacy_selector");if(c){c=b("DOM").scry(c,"span","button-text");c.length===1&&b("DOM").setContent(c[0],a)}},_getComposerView:function(){return b("$")("composer-main-view-id")},_hasTags:function(a){a=b("Parent").bySelector(a,"._27-k");return a!==null},_updateSticky:function(a,c){var d=b("MCompositionPrivacyStore").get("NEVER_SAVE_STICKY",!1);if(!d){d=new(b("MRequest"))(a).setAutoProcess(!1).setMethod("POST").setData({privacyx:c});d.listen("done",function(){b("MModalDialog").close({canceled:!1,goBack:!0})});b("MModalDialog").setSpinnerVisibility(!0);b("MModalDialog").setHeaderButtonsEnabledState(!1);d.send()}else b("MModalDialog").close({canceled:!1,goBack:!0})}};e.exports=a}),null);
__d("MStructuredComposerSATP",["fbt","CSS","DOM","EventListener","Keys","MCompositionShareStore","Stratcom","Style"],(function(a,b,c,d,e,f,g){e.exports={init:function(a){var c=this;this.presets=[];this.originalLabel="";this.currentPresetIndex=-1;this.clearStylePropertyNames={};this.textAreaContainer=a.textArea;this.satpChooser=a.satpChooser;this.hiddenInput=a.hiddenInput;this.satpHidden=!1;var d=b("DOM").find(this.textAreaContainer,"textarea","composer-textarea");this.textArea=d;this.textAreaPlaceholder=b("DOM").scry(this.textAreaContainer,"div","js_placeholder")[0];this.newlinesLimit=a.newlinesLimit;this.textLengthLimit=a.textLengthLimit;this.presetApplied=!1;this.checkinActive=!1;this.linkShareActive=!1;b("EventListener").listen(d,"input",function(){c._recalcSATPVisibility()});(a=b("Stratcom")).listen("MMultiPhotoUploader:attachments:change",null,function(a){c.photoCount=(a.getData().sending||0)+(a.getData().uploaded||0)+(a.getData().polling||0),c._recalcSATPVisibility()});a.listen("m:quicksearch:places:click",null,function(a){c.checkinActive=!0,c._recalcSATPVisibility()});a.listen("m:quicksearch:places:clear",null,function(a){c.checkinActive=!1,c._recalcSATPVisibility()});b("MCompositionShareStore").addListener("change",function(){c.linkShareActive=b("MCompositionShareStore").get("SHARE_URI")!==null,c._recalcSATPVisibility()});a.listen("MStructuredComposer:reset",null,function(){c.activePreset=null,c.checkinActive=!1,c.linkShareActive=!1,c.photoCount=0,c._clearPreset()})},initPreset:function(a){var c=this,d=this.presets.length;this.presets.push(a.element);b("EventListener").listen(a.element,"click",function(){c._applyPreset(a.preset);if(d!=c.currentPresetIndex){c._restoreLabel();var b=a.element.getAttribute("aria-label");c.originalLabel=b;c.currentPresetIndex=d;b=((b=b)!=null?b:"")+g._(", s\u00e9lectionn\u00e9").toString();a.element.setAttribute("aria-label",b)}});b("EventListener").listen(a.element,"keyup",function(d){(d.keyCode===b("Keys").SPACE||d.keyCode===b("Keys").RETURN)&&c._applyPreset(a.preset)})},initClearPreset:function(a){var c=this;this.clearStylePropertyNames=a.clearStylePropertyNames;b("EventListener").listen(a.element,"click",function(){c.activePreset=null,c._clearPreset(),c._restoreLabel(),c.currentPresetIndex=-1,c.originalLabel=""});b("EventListener").listen(a.element,"keyup",function(a){(a.keyCode===b("Keys").SPACE||a.keyCode===b("Keys").RETURN)&&(c.activePreset=null,c._clearPreset(),c._restoreLabel(),c.currentPresetIndex=-1,c.originalLabel="")})},_clearPreset:function(){if(!this.presetApplied)return;this.hiddenInput.value="";this.presetApplied=!1;b("Style").apply(this.textAreaContainer,this.clearStylePropertyNames);b("CSS").removeClass(this.textAreaContainer,"active-satp-preset");b("Style").apply(this.textArea,this.clearStylePropertyNames);this.textAreaPlaceholder!==void 0&&b("Style").apply(this.textAreaPlaceholder,this.clearStylePropertyNames);b("Stratcom").invoke("MStructuredComposerSATP:changed",null,null)},_recalcSATPVisibility:function(){var a=this.photoCount||0;if(a>0||this.checkinActive||this.linkShareActive){this._hideSATP();return}a=this.textArea.value;var b=a.split("\n",this.newlinesLimit+2);if(b.length-1>this.newlinesLimit||Array.from(a).length>this.textLengthLimit){this._hideSATP();return}this._showSATP()},_showSATP:function(){this.satpHidden&&(this.satpHidden=!1,this.satpChooser.style.display="block",this.activePreset&&this._applyPreset(this.activePreset))},_hideSATP:function(){this.satpHidden||(this.satpHidden=!0,this.satpChooser.style.display="none",this._clearPreset())},_applyPreset:function(a){this._clearPreset(),this.presetApplied=!0,this.hiddenInput.value=a.presetID,this.activePreset=a,this._applyStyle(this.textAreaContainer,this.activePreset.bodyStyle),this._applyStyle(this.textArea,this.activePreset.textInputStyle+";height: 208px;"),b("CSS").addClass(this.textAreaContainer,"active-satp-preset"),this.textAreaPlaceholder!==void 0&&this._applyStyle(this.textAreaPlaceholder,this.activePreset.textInputStyle),b("Stratcom").invoke("MStructuredComposerSATP:changed",null,this.activePreset)},_applyStyle:function(a,b){a.style.cssText+=";"+b},_restoreLabel:function(){if(this.currentPresetIndex>=0&&this.currentPresetIndex<this.presets.length){var a=this.presets[this.currentPresetIndex];a.setAttribute("aria-label",this.originalLabel)}}}}),null);